import{h as Q,u as f}from"./C-QmXMO2.js";import{s as Z}from"./CoS0jMrp.js";import{G as ee,i as t,H as ne,C as te,j as ie,y as g,_ as oe,o as G,c as T,a,s as S,v as N,p as se,e as le,b as ae}from"./C2egFmNW.js";import{_ as re}from"./evITL-mf.js";import{_ as ue}from"./lXXSD6iP.js";import"./C4iS2aBk.js";import"./O97EOHsH.js";import"./DQqw_gti.js";import"./CMS5Braa.js";import"./D3j8g8Cz.js";import"./Cq3l7X6R.js";function x(e,n){this.playlist=e,this.location=n,this.index=0}x.prototype={showMediaInformation(e){"mediaSession"in navigator&&(navigator.mediaSession.metadata=new MediaMetadata({title:e,artist:"Mindboost",artwork:[{src:"/images/scenery/"+e+".jpg",sizes:"96x96",type:"image/jpeg"}]}))},createNewHowl(e){return new Q.Howl({src:[`/${this.location}/${e.file}.m4a`,`/${this.location}}/${e.file}.ogg`],html5:!0,loop:!0,autoplay:!1,mute:!1,onplay:()=>{e.node=null;const o=e.howl,c=Howler.ctx,p=o._sounds[0]._node;this.showMediaInformation(e.file.charAt(0).toUpperCase()),e.node=c.createMediaElementSource(p)},onload:()=>{},onend:()=>{e.sound=null,e.node=null,this.skip("next")},onpause:()=>{},onstop:()=>{e.sound=null,e.node=null}})},initializeAudioNode(){const e=this.playlist[index];return Howler.ctx.createMediaElementSource(e._sounds[0]._node)},play(){const e=this.playlist[index].howl,n=this.playlist[index].title;e.state()==="loaded"&&e.play(),this.addMediaNavigationHandling(n)},initializeHowl(e=0){const n=this.playlist[e];this.index=e;let o;return n.howl?o=n.howl:(o=n.howl=this.createNewHowl(n),o.node=n.node=initializeAudioNode()),n.node instanceof MediaElementAudioSourceNode||(n.node=null,n.node=Howler.ctx.createMediaElementSource(o._sounds[0]._node)),o},pause(){this.playlist[self.index].howl.pause(),removeMediaNavigationHandling(),playBtn.style.display="block",pauseBtn.style.display="none"},skip(e){let n=0;e==="prev"?(n=this.index-1,n<0&&(n=this.playlist.length-1)):(n=this.index+1,n>=this.playlist.length&&(n=0)),this.skipTo(n)},skipTo(e){this.playlist[this.index].howl&&(this.playlist[this.index].howl.stop(),this.playlist[this.index].node.disconnect(),this.playlist[this.index].node=null),this.initializeHowl(e)},setBarWidth(e){const n=e*90/100;barFull.style.width=`${n*100}%`,sliderBtn.style.left=`${window.innerWidth*n+window.innerWidth*.05-25}px`},setVolume(e){Howler.volume(e),this.setBarWidth()},seek(e){const n=this.playlist[this.index].howl;n.playing()&&n.seek(n.duration()*e)},step(){const e=()=>{const n=this.playlist[this.index].howl,o=n.seek()||0;timer.innerHTML=this.formatTime(Math.round(o)),progress.style.width=`${o/n.duration()*100||0}%`,n.playing()&&requestAnimationFrame(e)};requestAnimationFrame(e)},togglePlaylist(){const e=playlist.style.display==="block"?"none":"block";setTimeout(()=>{playlist.style.display=e},e==="block"?0:500),playlist.className=e==="block"?"fadein":"fadeout"},toggleVolume(){const e=volumeDivRef.style.display==="block"?"none":"block";setTimeout(()=>{volumeDivRef.style.display=e},e==="block"?0:500),volumeDivRef.className=e==="block"?"fadein":"fadeout"},formatTime(e){const n=Math.floor(e/60)||0,o=e-n*60||0;return`${n}:${o<10?"0":""}${o}`},removeMediaNavigationHandling(){"mediaSession"in navigator&&(navigator.mediaSession.setActionHandler("play",null),navigator.mediaSession.setActionHandler("pause",null),navigator.mediaSession.setActionHandler("previoustrack",null),navigator.mediaSession.setActionHandler("nexttrack",null))},addMediaNavigationHandling(){"mediaSession"in navigator&&(this.showMediaInformation(),navigator.mediaSession.setActionHandler("play",e=>{this.play()}),navigator.mediaSession.setActionHandler("pause",e=>{this.pause()}),navigator.mediaSession.setActionHandler("previoustrack",()=>{this.skipTo(playlist.index-1)}),navigator.mediaSession.setActionHandler("nexttrack",()=>{this.skipTo(playlist.index-1)}))}};const de=ee({name:"AudioPlayer",setup(){const e=t(null),n=t(null),o=t(null),c=t(null),p=t(null),k=t(null),r=t(null),b=t(null),$=t(null),B=t(null),P=t(null),V=t(null),E=t(null),I=t(null),W=t(null),D=t(null),_=t(null),C=t(null),R=t(null),U=t(null),m=t(0),h=t(0),M=[{title:"Lagoon",file:"lagoon",howl:null,node:null},{title:"Meadow",file:"meadow",howl:null,node:null},{title:"Tropics",file:"tropics",howl:null,node:null},{title:"Forest",file:"forest",howl:null,node:null}],F=[{title:"noise",file:"noise",howl:null,node:null}],z=t(M[0]),L=t(0),X=i=>e.value?.skip(i),j=t(!1),q=i=>{if(j.value){const s="touches"in i?i.touches[0].clientX:i.clientX,u=window.innerWidth*.05,w=s-u;if(_.value){const y=_.value,v=Math.min(1,Math.max(0,w/parseFloat(y.scrollWidth.toString())));e.value?.setVolume(v)}}},Y=i=>q(i),d=t(null),l=t(null),J=i=>{if(i.preventDefault(),d.value!=null){const s=Math.sign(i.deltaY),u=h.value;u-s<101&&u-s>-1&&(h.value-=s)}},K=i=>{if(i.preventDefault(),l.value!=null){const s=Math.sign(i.deltaY),u=m.value;u-s<101&&u-s>-1&&(e.value?.setVolume(),m.value-=s)}};ne(()=>{n.value=null,e.value=null,f().resetAudioContext()}),te(async()=>{const i=new x(M,"sounds"),s=new x(F,"masking");Howler.mute(!0),f().setPlayers({scenePlayer:i,noisePlayer:s});const u=ie().getUserScenery;i.skip("prev"),i.skip("next"),i.skip("prev"),i.skip("next");const w=s.playlist[0].node,y=i.playlist.filter(H=>H.title.toLowerCase()===u.toLowerCase()),v=await Z(w,y[0].node);try{y[0].howl.play(),s.playlist[0].howl.play(),d.value=v.pop(),l.value=v.pop(),l.value&&d.value&&(l.value.gain.value=.5,d.value.gain.value=.5,Howler.masterGain.disconnect())}catch{}i.play(),s.play()});const O=t(f().playlistIndex);return g(O.value,i=>{l.value instanceof GainNode&&l.value.gain.linearRampToValueAtTime(i/100,l.value.context.currentTime+.2)}),g(m,i=>{l.value instanceof GainNode&&l.value.gain.linearRampToValueAtTime(i/100,l.value.context.currentTime+.2)}),g(h,i=>{f().playlistIndex++,d.value!=null&&d.value instanceof GainNode&&d.value.gain.linearRampToValueAtTime(i/100,d.value.context.currentTime+.2)}),{bar:E,barFull:C,currentTrack:z,duration:p,handleSkip:X,handleVolume:Y,list:W,loading:I,nextBtn:$,pauseBtn:r,playBtn:k,playlistBtn:B,playlistElement:U,prevBtn:b,progress:V,progressWidth:L,scenePlayer:e,noisePlayer:n,timer:c,track:o,volumeBtn:P,volumeDivRef:D,waveform:R,outputNoiseGain:h,outputMusicGain:m,changeNoiseGain:J,changeMusicGain:K}}}),A=e=>(se("data-v-6c2a07a2"),e=e(),le(),e),ce={class:"rnboplayer"},pe={class:"row"},me={class:"slider"},he=A(()=>a("div",{class:"icon"},[a("img",{style:{width:"25px"},src:re})],-1)),ye={class:"row"},ve={class:"slider"},fe=A(()=>a("div",{class:"icon"},[a("img",{style:{width:"25px"},src:ue})],-1));function we(e,n,o,c,p,k){return G(),T("div",ce,[a("div",pe,[a("div",me,[he,S(a("input",{id:"gain-control","onUpdate:modelValue":n[0]||(n[0]=r=>e.outputNoiseGain=r),type:"range",min:"0",max:"100",step:"1",onWheel:n[1]||(n[1]=(...r)=>e.changeNoiseGain&&e.changeNoiseGain(...r))},null,544),[[N,e.outputNoiseGain]])])]),a("div",ye,[a("div",ve,[fe,S(a("input",{id:"gain-control","onUpdate:modelValue":n[2]||(n[2]=r=>e.outputMusicGain=r),type:"range",min:"0",max:"100",default:"50",step:"1",onWheel:n[3]||(n[3]=(...r)=>e.changeMusicGain&&e.changeMusicGain(...r))},null,544),[[N,e.outputMusicGain]])])])])}const ge=oe(de,[["render",we],["__scopeId","data-v-6c2a07a2"]]),$e={__name:"index",setup(e){return(n,o)=>(G(),T("div",null,[ae(ge)]))}};export{$e as default};
