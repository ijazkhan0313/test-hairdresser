import{A}from"./lEC4QW_W.js";import{i as m}from"./O97EOHsH.js";import{i as p}from"./DQqw_gti.js";import{u as f,c as N}from"./C-QmXMO2.js";import{_ as C,o as u,c as g,a,d as E,t as G,l as S,w as x,g as T,r as _,p as y,e as w}from"./C2egFmNW.js";import"./C4iS2aBk.js";const k={components:{AudioElement:A},data(){return{audioList:[{id:1,title:"Lagoon",src:window.location.origin+"/sounds/lagoon.m4a"},{id:2,title:"Forest",src:window.location.origin+"/sounds/forest.m4a"},{id:3,title:"Meadow",src:window.location.origin+"/sounds/meadow.m4a"},{id:4,title:"Tropics",src:window.location.origin+"/sounds/tropics.m4a"}],noise:{id:5,title:"Noise",src:window.location.origin+"/masking/noise.flac"},selectedAudioTitle:"",currentElement:{},createdNodes:{},musicPatch:m,noisePatch:p,audioContext:null,playState:!1}},computed:{selectedAudio(){return this.audioList.find(e=>e.title===this.selectedAudioTitle)||null},checkContextCompatibility(){const e=Object.values(this.createdNodes),i=e.filter(n=>n.context!==this.audioContext);return e.length===e.length-i.length?!0:(this.handleIncompatibeError(i),!1)},isPlaying(){return this.playState}},beforeUnmount(){this.disconnectNodes(),this.audioContext&&this.audioContext.close(),this.audioContext=null},mounted(){this.audioContext=f().getContext(),this.selectAudioByTitle(this.audioList[0].title),this.addUserNavigationHandling(),this.musicPatch=m,this.noisePatch=p},methods:{changeNoiseVolume(e){this.createdNodes.noiseGain&&(this.createdNodes.noiseGain.gain.linearRampToValueAtTime(e,this.createdNodes.noiseGain.context.currentTime+.3),this.noiseGain=this.createdNodes.noiseGain.gain.value)},changeMusicVolume(e){this.createdNodes.musicGain&&(this.createdNodes.musicGain.gain.linearRampToValueAtTime(e,this.createdNodes.musicGain.context.currentTime+.3),this.musicGain=this.createdNodes.musicGain.gain.value)},addUserNavigationHandling(){"mediaSession"in navigator&&(navigator.mediaSession.setActionHandler("nexttrack",()=>{this.skip("next")}),navigator.mediaSession.setActionHandler("previoustrack",()=>{this.skip("previous")}))},getSong(e,i){let t=this.audioList.findIndex(o=>o.title===e)+(i==="next"?1:-1);return t>=this.audioList.length?t=0:t<0&&(t=this.audioList.length-1),this.audioList[t]},skip(e){const i=this.getSong(this.selectedAudioTitle,e);this.selectAudioByTitle(i.title)},resumeContext(){this.audioContext.state==="suspended"&&this.audioContext.resume()},stopContext(){this.audioContext.state==="running"&&this.audioContext.suspend()},updateCurrentElement(e){this.currentElement=this.audioList.find(i=>i.title===e)},selectAudioByTitle(e){this.selectedAudioTitle=e,this.currentElement=this.audioList[this.audioList.findIndex(i=>i.title===e)]},areAllNodesAvailable(){return["musicSource","musicSplitter","microphoneSource","musicDevice","outputSplitter","musicGain","noiseSource","noiseSplitter","noiseDevice","noiseGain","merger"].every(i=>this.createdNodes[i]!==void 0)},handleIncompatibeError(e){if(e&&e.pop().context!==this.createdNodes.musicSplitter.context){const n=this.createdNodes.musicSplitter.context;this.createdNodes.musicSource||=n.createMediaElementSource(musicAudioElement)}},connectNodes(){try{const{musicSource:e,musicSplitter:i,microphoneSource:n,musicDevice:t,outputSplitter:o,musicGain:s,noiseSource:r,noiseSplitter:c,noiseDevice:d,noiseGain:h,merger:l}=this.createdNodes;if(!this.checkContextCompatibility&&!this.checkContextCompatibility)throw new Error("Incompatible audio context among nodes.");e.connect(i),n.connect(t,0,0),i.connect(t,0,1),i.connect(t,1,2),t.connect(o),t.connect(s),r.connect(c),n.connect(d,0,0),c.connect(d,0,1),c.connect(d,1,2),o.connect(d,0,3),o.connect(d,1,4),d.connect(h),h.connect(l,0,0),h.connect(l,0,1),s.connect(l,0,2),s.connect(l,0,3),l.connect(l.context.destination)}catch{}},handlePlayingUpdate(e){const i=this.audioContext?this.audioContext:f().getContext();let n=null;if(e)if(this.areAllNodesAvailable()){this.disconnectNodes();const t=this.$refs[this.currentElement.title].$refs.audioElement,o=this.createdNodes.musicGain.gain.value,s=this.createdNodes.noiseGain.gain.value;this.$refs[this.currentElement.title].$refs.audioElement.muted=!1,this.$refs.Noise.$refs.audioElement.muted=!1,this.createdNodes.musicSource=null,this.createdNodes.musicSource=i.createMediaElementSource(t),this.connectNodes(),o>0&&o<=1&&this.createdNodes.musicGain.gain.linearRampToValueAtTime(o||1,i.currentTime+2),s>0&&s<=1&&this.createdNodes.noiseGain.gain.linearRampToValueAtTime(s||1,i.currentTime+3),this.audioContext.resume()}else navigator.mediaDevices.getUserMedia({audio:{echoCancellation:!1,noiseSuppression:!1,autoGainControl:!1},video:!1}).then(t=>(n=this.audioContext.createMediaStreamSource(t),this.createdNodes.microphoneSource||=n,{audioContext:i,microphoneSource:n})).then(({audioContext:t,microphoneSource:o})=>N(t,this.noisePatch).then(s=>(this.createdNodes.noiseRNBODevice||=s,{audioContext:t,microphoneSource:o,noiseRNBODevice:s}))).then(({audioContext:t,microphoneSource:o,noiseRNBODevice:s})=>N(t,this.musicPatch).then(r=>(this.createdNodes.musicRNBODevice||=r,{audioContext:t,microphoneSource:o,noiseRNBODevice:s,musicRNBODevice:r}))).then(({audioContext:t,microphoneSource:o,noiseRNBODevice:s,musicRNBODevice:r})=>{const d=this.$refs[this.currentElement.title].$refs.audioElement;this.createdNodes||={},this.createdNodes.microphoneSource||=o,this.createdNodes.musicDevice||=r.node,this.createdNodes.noiseDevice||=s.node,this.createdNodes.noiseSource||=t.createMediaElementSource(this.$refs.Noise.$refs.audioElement),this.createdNodes.musicSource||=t.createMediaElementSource(d),this.createdNodes.musicSplitter||=t.createChannelSplitter(2),this.createdNodes.noiseSplitter||=t.createChannelSplitter(2),this.createdNodes.outputSplitter||=t.createChannelSplitter(2),this.createdNodes.musicGain||=t.createGain(),this.createdNodes.noiseGain||=t.createGain(),this.createdNodes.merger||=t.createChannelMerger(4),d.muted=!1,this.$refs.Noise.$refs.audioElement.muted=!1,this.createdNodes.musicGain.gain.value=1e-4,this.createdNodes.noiseGain.gain.value=1e-4,this.connectNodes(),setTimeout(()=>{this.playState=!0,this.createdNodes.musicGain.gain.exponentialRampToValueAtTime(1,t.currentTime+3),this.createdNodes.noiseGain.gain.exponentialRampToValueAtTime(1,t.currentTime+4),t.state==="suspended"&&this.resumeContext()},150)}).catch(t=>{this.disconnectNodes(),this.audioContext&&this.audioContext.destination.disconnect(),this.$toast.error("Oouh sorry! Error while setting up audio, please reload.")});else this.audioContext.suspend()},disconnectNodes(){typeof this.createdNodes=="object"&&this.createdNodes!==null&&(Object.values(this.createdNodes).forEach(e=>{e&&typeof e.disconnect=="function"&&e.disconnect(),e instanceof OscillatorNode&&e.stop()}),this.playState=!1)}}},v=e=>(y("data-v-c06c612e"),e=e(),w(),e),b=v(()=>a("h2",null,"Press Space to start, wait few seconds then the sound should start. You will hear the arifacts right after the music begins",-1)),V=v(()=>a("h2",null,"These file contain both patches, use Gainsliders of AudioElement to control volume and allow to skip. AudioStore used for shared AudioContext",-1)),M={class:"rnboplayer"},P={key:0},U={class:"row"},L={class:"col-auto"},I={class:"col-auto"},D={class:"col-auto"};function B(e,i,n,t,o,s){const r=_("AudioElement");return u(),g("div",null,[b,V,a("div",M,[o.selectedAudioTitle?(u(),g("div",P,[E(G(s.selectedAudio.title)+" ",1),(u(),S(r,{ref:s.selectedAudio.title,key:s.selectedAudio.id,src:s.selectedAudio.src,title:s.selectedAudio.title,"onUpdate:playing":s.handlePlayingUpdate,"onUpdate:volume":s.changeMusicVolume},{default:x(({})=>[]),_:1},8,["src","title","onUpdate:playing","onUpdate:volume"]))])):T("",!0),(u(),S(r,{ref:o.noise.title,key:o.noise.id,src:o.noise.src,title:o.noise.title,"onUpdate:volume":s.changeNoiseVolume},{default:x(({})=>[]),_:1},8,["src","title","onUpdate:volume"])),a("div",U,[a("div",L,[a("button",{onClick:i[0]||(i[0]=(...c)=>s.skip&&s.skip(...c))}," Skip ")]),a("div",I,[a("button",{onClick:i[1]||(i[1]=(...c)=>s.resumeContext&&s.resumeContext(...c))}," Resume Context ")]),a("div",D,[a("button",{onClick:i[2]||(i[2]=(...c)=>s.stopContext&&s.stopContext(...c))}," Suspend Context ")])])])])}const Y=C(k,[["render",B],["__scopeId","data-v-c06c612e"]]);export{Y as default};
