import{_ as T}from"./BvTjjB-h.js";import{_ as k}from"./0ZZ5o62G.js";import{_ as G,u as C,o as m,c as f,a as o,n as N,b as v,w as g,d as x,t as _,l as S,g as M,r as V,p as E,e as B}from"./C2egFmNW.js";import{A as U}from"./lEC4QW_W.js";import{i as w}from"./O97EOHsH.js";import{i as y}from"./DQqw_gti.js";import{c as A}from"./C-QmXMO2.js";import"./DXkrL135.js";import"./D3j8g8Cz.js";import"./CMS5Braa.js";import"./C4iS2aBk.js";const L={components:{AudioElement:U},data(){return{t:C,audioList:[{id:1,title:"Lagoon",src:window.location.origin+"/sounds/lagoon.m4a"},{id:2,title:"Forest",src:window.location.origin+"/sounds/forest.m4a"},{id:3,title:"Meadow",src:window.location.origin+"/sounds/meadow.m4a"},{id:4,title:"Tropics",src:window.location.origin+"/sounds/tropics.m4a"}],noise:{id:5,title:"Noise",src:window.location.origin+"/masking/noise.flac"},selectedAudioTitle:"",currentElement:{},createdNodes:{},musicPatch:w,noisePatch:y,audioContext:null,isPlayerRunning:!1,checked:!1,meter:null,bar_width:0,analyser:null,dataArray:null,bar_val:25}},computed:{selectedAudio(){return this.audioList.find(e=>e.title===this.selectedAudioTitle)||null},deviceUsed(){return this.isPlayerRunning}},beforeUnmount(){this.disconnectNodes(),this.audioContext&&this.audioContext.close(),this.audioContext=null},mounted(){this.audioContext=new AudioContext,this.currentElement=this.audioList[0],this.selectAudioByTitle(this.audioList[0].title),this.addUserNavigationHandling(),this.musicPatch=w,this.noisePatch=y},methods:{changeMusicVolume(e){this.createdNodes.musicGain.gain&&(this.createdNodes.musicGain.gain.cancelScheduledValues(this.createdNodes.musicGain.context.currentTime),this.createdNodes.musicGain.gain.setValueAtTime(e/100,this.createdNodes.musicGain.context.currentTime+.01))},changeNoiseVolume(e){this.createdNodes.noiseGain.gain&&this.createdNodes.noiseGain.gain.setValueAtTime(e/100,this.createdNodes.noiseGain.context.currentTime+.01)},addUserNavigationHandling(){"mediaSession"in navigator&&(navigator.mediaSession.setActionHandler("nexttrack",()=>{this.skip("next")}),navigator.mediaSession.setActionHandler("previoustrack",()=>{this.skip("previous")}))},getSong(e,i){let a=this.audioList.findIndex(t=>t.title===e)+(i==="next"?1:-1);return a>=this.audioList.length?a=0:a<0&&(a=this.audioList.length-1),this.audioList[a]},skip(e){const i=this.getSong(this.selectedAudioTitle,e);this.selectAudioByTitle(i.title)},updateCurrentElement(e){this.currentElement=this.audioList.find(i=>i.title===e)},selectAudioByTitle(e){this.selectedAudioTitle=e,this.currentElement=this.audioList[this.audioList.findIndex(i=>i.title===e)]},areAllNodesAvailable(){return["musicSource","musicSplitter","microphoneSource","musicDevice","outputSplitter","musicGain","noiseSource","noiseSplitter","noiseDevice","noiseGain","merger"].every(i=>this.createdNodes[i]!==void 0)},updateMeter(){requestAnimationFrame(this.updateMeter),this.analyser.getByteFrequencyData(this.dataArray);const e=this.getRMS(this.dataArray);let i=20*Math.log10(e/128);i=Math.max(0,Math.min(100,i+100)),this.bar_width=i},getRMS(e){let i=0;for(let n=0;n<e.length;n++)i+=e[n]*e[n];return i/=e.length,i=Math.sqrt(i),i},connectNodes(){const e=this.createdNodes.microphoneSource.context;this.analyser=e.createAnalyser(),this.createdNodes.microphoneSource.connect(this.analyser),this.analyser.fftSize=2048;const i=this.analyser.frequencyBinCount;this.dataArray=new Uint8Array(i),this.updateMeter();const{musicSource:n,musicSplitter:a,microphoneSource:t,musicDevice:s,outputSplitter:c,musicGain:r,noiseSource:h,noiseSplitter:u,noiseDevice:d,noiseGain:p,merger:l}=this.createdNodes;n.connect(a),t.connect(s,0,0),a.connect(s,0,1),a.connect(s,1,2),s.connect(c),s.connect(r),h.connect(u),t.connect(d,0,0),u.connect(d,0,1),u.connect(d,1,2),c.connect(d,0,3),c.connect(d,1,4),d.connect(p),p.connect(l,0,0),p.connect(l,0,1),r.connect(l,0,2),r.connect(l,0,3),l.connect(l.context.destination)},handlePlayingUpdate(e){const i=window.AudioContext||window.webkitAudioContext||window.mozAudioContext||window.oAudioContext||window.msAudioContext;let n=this.audioContext?this.audioContext:new i,a=null;e?this.areAllNodesAvailable()?(this.disconnectNodes(),this.connectNodes(),this.createdNodes.noiseGain.gain.exponentialRampToValueAtTime(1,n.currentTime+2),this.createdNodes.noiseGain.gain.exponentialRampToValueAtTime(1,n.currentTime+3)):navigator.mediaDevices.getUserMedia({audio:{echoCancellation:!1,noiseSuppression:!1,autoGainControl:!1},video:!1}).then(t=>(n=new i,a=n.createMediaStreamSource(t),this.createdNodes.microphoneSource||=a,{audioContext:n,microphoneSource:a})).then(({audioContext:t,microphoneSource:s})=>A(t,this.noisePatch).then(c=>(this.createdNodes.noiseRNBODevice||=c,{audioContext:t,microphoneSource:s,noiseRNBODevice:c}))).then(({audioContext:t,microphoneSource:s,noiseRNBODevice:c})=>A(t,this.musicPatch).then(r=>(this.createdNodes.musicRNBODevice||=r,{audioContext:t,microphoneSource:s,noiseRNBODevice:c,musicRNBODevice:r}))).then(({audioContext:t,microphoneSource:s,noiseRNBODevice:c,musicRNBODevice:r})=>{this.createdNodes||={},this.createdNodes.microphoneSource||=s,this.createdNodes.musicDevice||=r.node,this.createdNodes.noiseDevice||=c.node,this.createdNodes.noiseSource||=t.createMediaElementSource(this.$refs.Noise.$refs.audioElement),this.createdNodes.musicSource||=t.createMediaElementSource(this.$refs[this.currentElement.title].$refs.audioElement),this.createdNodes.musicSplitter||=t.createChannelSplitter(2),this.createdNodes.noiseSplitter||=t.createChannelSplitter(2),this.createdNodes.outputSplitter||=t.createChannelSplitter(2),this.createdNodes.musicGain||=t.createGain(),this.createdNodes.noiseGain||=t.createGain(),this.createdNodes.merger||=t.createChannelMerger(4),this.createdNodes.musicGain.gain.value=.001,this.createdNodes.noiseGain.gain.value=.001,this.connectNodes(),this.createdNodes.musicGain.gain.exponentialRampToValueAtTime(.5,t.currentTime+3),this.createdNodes.noiseGain.gain.exponentialRampToValueAtTime(.5,t.currentTime+4)}).catch(t=>{this.audioContext&&this.audioContext.destination.disconnect()}):this.disconnectNodes()},disconnectNodes(){this.createdNodes!==null&&Object.values(this.createdNodes).forEach(e=>{e&&typeof e.disconnect=="function"&&e.disconnect(),e instanceof OscillatorNode&&e.stop()})}}},b=e=>(E("data-v-b4a2440d"),e=e(),B(),e),P={class:"rnboplayer"},D={class:"switch"},R=["v-model"],I=b(()=>o("span",{class:"slider"},null,-1)),q={class:"container-fluid"},j={class:"row justify-content-center"},H={class:"adaptive pb-3"},O={class:"col-12"},z={class:"d-none d-md-block mx-auto pb-1",style:{width:"225px"}},F={class:"progress",style:{height:"10px"}},J={class:"d-flex justify-content-center mb-1"},K={class:"",style:{color:"#e9c046"}},Q=b(()=>o("span",{class:"ps-3"},[o("i",{style:{padding:"5px 0px"},class:"fa-solid text-muted d-flex fa-chevron-right"})],-1)),W={class:"d-block d-md-none mx-auto pb-1",style:{width:"225px"}},X={class:"progress",style:{height:"10px"}},Y={key:0};function Z(e,i,n,a,t,s){const c=T,r=k,h=V("AudioElement");return m(),f("div",P,[o("label",D,[o("input",{type:"checkbox","v-model":s.deviceUsed},null,8,R),I]),o("div",q,[o("div",j,[o("div",H,[o("div",O,[o("div",z,[o("div",F,[o("div",{class:"progress-bar bar",role:"progressbar","aria-label":"Basic example",style:N([{width:t.bar_width+"%"},{"background-color":"#e9c046",transition:"0.1s"}]),"aria-valuenow":"75","aria-valuemin":"0","aria-valuemax":"100"},null,4)])]),o("div",J,[v(c,{to:"#adaptive-modal","data-bs-target":"#adaptive-modal","data-bs-toggle":"modal",class:"text-muted text-decoration-none fw-bold fs-6"},{default:g(()=>[x(_(t.t("Adaptive soundscape"))+" : ",1),o("span",K,_(t.t("On")),1)]),_:1}),Q]),o("div",W,[o("div",X,[o("div",{class:"progress-bar bar",role:"progressbar","aria-label":"Basic example",style:N([{width:t.bar_width+"%"},{"background-color":"#e9c046",transition:"0.1s"}]),"aria-valuenow":"75","aria-valuemin":"0","aria-valuemax":"100"},null,4)])])]),v(r)])])]),t.selectedAudioTitle?(m(),f("div",Y,[x(_(s.selectedAudio.title)+" ",1),(m(),S(h,{ref:s.selectedAudio.title,key:s.selectedAudio.id,src:s.selectedAudio.src,title:s.selectedAudio.title,"onUpdate:playing":s.handlePlayingUpdate,onVolume:s.changeMusicVolume},{default:g(({})=>[]),_:1},8,["src","title","onUpdate:playing","onVolume"]))])):M("",!0),(m(),S(h,{ref:t.noise.title,key:t.noise.id,src:t.noise.src,title:t.noise.title,"onUpdate:playing":s.handlePlayingUpdate,onVolume:s.changeNoiseVolume},{default:g(({})=>[]),_:1},8,["src","title","onUpdate:playing","onVolume"])),o("button",{onClick:i[0]||(i[0]=(...u)=>s.skip&&s.skip(...u))}," Skip ")])}const le=G(L,[["render",Z],["__scopeId","data-v-b4a2440d"]]);export{le as default};
